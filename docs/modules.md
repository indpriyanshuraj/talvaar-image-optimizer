# Module Details

> This documentation was generated by Google Gemini 2.5.

This document details the purpose and function of each module within the `resizer_module` package.

---

## `resizer_module/cli.py`

**Purpose**: The main orchestrator of the application. It handles all user-facing interactions, from parsing CLI arguments to running the interactive prompt loop.

### Key Functions

- **`cli_mode()`**:
    - **Description**: The primary entry point called by `main.py`. It checks if any command-line arguments were provided. If not, it hands off control to `interactive_mode()`. Otherwise, it uses `argparse` to interpret flags and orchestrates the non-interactive workflow.
    - **Dependencies**: `interactive_mode()`, `setup_logging()`, `run_processing()`.

- **`interactive_mode()`**:
    - **Description**: Provides a step-by-step guided questionnaire for the user. It uses the `rich.prompt` library to ask for input/output paths, resizing options, and other configurations.
    - **Dependencies**: `run_pre_analysis()`, `run_processing()`.

- **`run_processing(...)`**:
    - **Description**: Manages the overall batch processing of images. It initializes a `ProcessPoolExecutor` to run tasks in parallel and uses `rich.progress` to display a live progress bar.
    - **Dependencies**: `worker.py:process_single_image`.

- **`run_pre_analysis(...)`**:
    - **Description**: Implements the `--report` feature. It runs a quick scan of all input files (in parallel) to gather statistics on image types and transparency, then displays them in a `rich.table`.
    - **Dependencies**: `analysis.py:analyze_image`.

- **`setup_logging(...)`**:
    - **Description**: Configures the Python `logging` module to write detailed operational logs to `resizer.log`, which is controlled by the `--log` flag.

---

## `resizer_module/worker.py`

**Purpose**: Contains the logic for processing a single image. This function is designed to be executed in a separate process to leverage multiple CPU cores.

### Key Functions

- **`process_single_image(args)`**:
    - **Description**: This is the workhorse of the application. For a given image file path, it performs the entire pipeline:
        1. Opens the image using `Pillow`.
        2. Determines the correct output path and filename, applying prefixes/suffixes.
        3. Resizes the image using the automatically or manually selected algorithm.
        4. Calls the `smart_optimize` function or runs a manual save based on the chosen mode.
        5. Saves the final, optimized image buffer to disk.
    - **Dependencies**: `optimizer.py:smart_optimize`, `analysis.py:analyze_image`, `utils.py:get_unique_path`.

---

## `resizer_module/analysis.py`

**Purpose**: Provides functions for inspecting and classifying image properties.

### Key Functions

- **`analyze_image(img, file_path) -> ImageAnalysis`**:
    - **Description**: Takes a `Pillow` image object and its path, then returns a structured `ImageAnalysis` object. It detects:
        - **Transparency**: Checks for an alpha channel and classifies it as `none`, `binary` (hard-edge cutouts), or `partial` (semi-transparent glass).
        - **UI Context**: Checks if the file path suggests it's a UI texture.
        - **Suggested Algorithm**: Based on color count, UI context, and transparency, it suggests whether `NEAREST` or `LANCZOS` is a better resizing algorithm.
    - **Dependencies**: `utils.py:is_ui_texture`.

---

## `resizer_module/optimizer.py`

**Purpose**: Implements the intelligent, in-memory optimization strategies.

### Key Functions

- **`smart_optimize(...)`**:
    - **Description**: The core of the "auto" mode. It orchestrates the optimization process by:
        1. Calling `analyze_image` to understand the image.
        2. Calling `generate_candidates` to get a list of safe optimization methods to try.
        3. "Racing" the candidates by calling `save_candidate_buffer` for each one.
        4. Comparing the in-memory file size of each result against the original.
        5. Returning the buffer of the winning (smallest) candidate.
    - **Dependencies**: `analysis.py:analyze_image`, `generate_candidates()`, `save_candidate_buffer()`.

- **`generate_candidates(analysis, ...)`**:
    - **Description**: A rule-based function that decides which optimization methods are safe to try. For example, it will not suggest a `Palette` mode for an image with partial transparency, thus preventing visual corruption.
    - **Dependencies**: `analysis.py:ImageAnalysis`.

- **`save_candidate_buffer(...)`**:
    - **Description**: A helper function that takes a `Pillow` image and a save configuration, then saves the resulting file to an in-memory `io.BytesIO` buffer and returns the buffer and its size.
    - **Dependencies**: None.

---

## `resizer_module/utils.py`

**Purpose**: A collection of small, standalone helper functions.

### Key Functions

- **`get_unique_path(path)`**:
    - **Description**: Handles filename conflicts. If `file.png` exists, it will return `file_1.png`.
    - **Dependencies**: None.

- **`is_ui_texture(path)`**:
    - **Description**: Checks if a file path contains segments like `ui`, `gui`, or `font` to apply special handling.
    - **Dependencies**: None.
